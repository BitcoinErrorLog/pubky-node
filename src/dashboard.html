<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pubky Node</title>
    <link rel="stylesheet" href="/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app">
        <!-- Ambient glow -->
        <div class="ambient-glow"></div>

        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <svg class="logo-svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M16 2L28.66 10v12L16 30 3.34 22V10L16 2z" stroke="url(#logo-grad)" stroke-width="2"
                            fill="none" />
                        <circle cx="16" cy="16" r="5" fill="url(#logo-grad)" opacity="0.6" />
                        <circle cx="16" cy="16" r="2" fill="url(#logo-grad)" />
                        <defs>
                            <linearGradient id="logo-grad" x1="0" y1="0" x2="32" y2="32">
                                <stop offset="0%" stop-color="#818cf8" />
                                <stop offset="100%" stop-color="#6366f1" />
                            </linearGradient>
                        </defs>
                    </svg>
                    <span class="logo-text">Pubky Node</span>
                </div>
                <span class="version-pill" id="version">v0.0.0</span>
            </div>
            <div class="header-right">
                <nav class="tabs" id="nav-tabs">
                    <button class="tab active" data-tab="status">Networks</button>
                    <button class="tab" data-tab="keys">Keys</button>
                    <button class="tab" data-tab="homeserver">Homeserver</button>
                    <button class="tab" data-tab="explorer">Explorer</button>
                </nav>
                <div class="status-indicator" id="connection-status">
                    <span class="status-dot"></span>
                    <span class="status-label">Connecting...</span>
                    <span class="header-uptime" id="header-uptime"></span>
                </div>
                <div class="node-controls">
                    <!-- Guide icon -->
                    <button class="btn-icon" data-tab="guide" title="Guide" id="guide-icon-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                            <line x1="12" y1="17" x2="12.01" y2="17" />
                        </svg>
                    </button>
                    <!-- Settings icon -->
                    <button class="btn-icon" data-tab="settings" title="Settings" id="settings-icon-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
                        </svg>
                    </button>
                    <button id="node-restart-btn" class="btn-icon" title="Restart Node">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="23 4 23 10 17 10" />
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                        </svg>
                    </button>
                    <button id="node-shutdown-btn" class="btn-icon" title="Shutdown Node">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18.36 6.64a9 9 0 1 1-12.73 0" />
                            <line x1="12" y1="2" x2="12" y2="12" />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="main">
            <!-- ===== STATUS TAB ===== -->
            <div class="tab-content active" id="tab-status">
                <div class="grid">
                    <!-- DHT Panel -->
                    <section class="card" id="dht-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-blue">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="10" />
                                        <line x1="2" y1="12" x2="22" y2="12" />
                                        <path
                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                                    </svg>
                                </div>
                                <h2>Mainline DHT</h2>
                            </div>
                            <span class="badge" id="dht-badge">--</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">Node ID</span>
                                <span class="kv-val mono" id="node-id">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Listen Address</span>
                                <span class="kv-val mono" id="listen-addr">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Mode</span>
                                <span class="kv-val" id="dht-mode">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Firewalled</span>
                                <span class="kv-val" id="firewalled">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Network Size</span>
                                <span class="kv-val" id="rt-detail">--</span>
                            </div>
                        </div>
                    </section>

                    <!-- Relay Panel -->
                    <section class="card" id="relay-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-green">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                                    </svg>
                                </div>
                                <h2>PKARR Relay</h2>
                            </div>
                            <span class="badge badge-active">Active</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">HTTP Port</span>
                                <span class="kv-val mono" id="relay-port">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Endpoint</span>
                                <span class="kv-val">
                                    <a href="#" id="relay-url" target="_blank" class="link">--</a>
                                    <button class="copy-btn" id="relay-copy" title="Copy relay URL">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" />
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                        </svg>
                                    </button>
                                </span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Protocol</span>
                                <span class="kv-val">HTTP GET/PUT</span>
                            </div>
                        </div>
                    </section>

                    <!-- UPnP / Network Panel -->
                    <section class="card" id="upnp-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M5 12.55a11 11 0 0 1 14.08 0" />
                                        <path d="M1.42 9a16 16 0 0 1 21.16 0" />
                                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0" />
                                        <circle cx="12" cy="20" r="1" fill="currentColor" />
                                    </svg>
                                </div>
                                <h2>Network / UPnP</h2>
                            </div>
                            <span class="badge" id="upnp-badge">--</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">Port Mapping</span>
                                <span class="kv-val" id="upnp-status">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">External IP</span>
                                <span class="kv-val mono" id="upnp-external-ip">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Mapped Port</span>
                                <span class="kv-val mono" id="upnp-port">--</span>
                            </div>
                            <div id="upnp-guide" class="inline-guide collapsible" style="display:none;">
                                <div class="inline-guide-title collapsible-toggle" id="upnp-guide-toggle">
                                    <span>‚ö† Port mapping required</span>
                                    <svg class="collapse-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <path d="M6 9l6 6 6-6" />
                                    </svg>
                                </div>
                                <div class="collapsible-body">
                                    <p>Your router didn't automatically map ports. To enable full network participation:
                                    </p>
                                    <ol>
                                        <li>Log into your <strong>router admin panel</strong> (usually <a
                                                href="http://192.168.1.1" target="_blank"
                                                class="inline-link">192.168.1.1</a>)</li>
                                        <li>Find <strong>UPnP</strong> or <strong>NAT-PMP</strong> settings and enable
                                            them
                                        </li>
                                        <li>Or manually <strong>forward UDP port 6881</strong> to this machine</li>
                                        <li>Restart Pubky Node after making changes</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- HTTP Proxy Panel -->
                    <section class="card" id="proxy-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-amber">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9" />
                                    </svg>
                                </div>
                                <h2>HTTP Proxy</h2>
                            </div>
                            <span class="badge" id="proxy-badge">--</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">Status</span>
                                <span class="kv-val" id="proxy-status">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Listen Port</span>
                                <span class="kv-val mono" id="proxy-port">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Requests Served</span>
                                <span class="kv-val mono" id="proxy-requests">--</span>
                            </div>
                            <div class="proxy-setup" id="proxy-setup-unconfigured">
                                <button class="btn-primary btn-sm" id="proxy-setup-btn">‚ö° Configure /etc/hosts</button>
                            </div>
                            <div class="proxy-setup" id="proxy-setup-configured" style="display:none;">
                                <span style="color:#22c55e;font-size:13px;">‚úÖ Hosts configured</span>
                                <button class="btn-secondary btn-sm" id="proxy-reset-btn">Reset Hosts</button>
                            </div>
                            <div id="proxy-setup-feedback" class="dns-system-feedback" style="display:none;"></div>
                        </div>
                    </section>

                    <!-- PKDNS Panel -->
                    <section class="card" id="dns-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-blue">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="10" />
                                        <path d="M2 12h20" />
                                        <path
                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                                    </svg>
                                </div>
                                <h2>PKDNS Resolver</h2>
                            </div>
                            <span class="badge" id="dns-badge">--</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">Status</span>
                                <span class="kv-val" id="dns-status">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Listen Address</span>
                                <span class="kv-val mono" id="dns-socket">--</span>
                            </div>
                            <div class="kv-row">
                                <span class="kv-key">Upstream DNS</span>
                                <span class="kv-val mono" id="dns-forward">--</span>
                            </div>
                            <div id="dns-connected" class="inline-guide inline-guide-success collapsible"
                                style="display:none;">
                                <div class="inline-guide-title collapsible-toggle" id="dns-connected-toggle">
                                    <span>‚úÖ System DNS Connected</span>
                                    <svg class="collapse-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor" stroke-width="2">
                                        <path d="M6 9l6 6 6-6" />
                                    </svg>
                                </div>
                                <div class="collapsible-body">
                                    <p>Your system DNS is pointing to this resolver. <code>.pkarr</code>,
                                        <code>.key</code>,
                                        and <code>.pubky</code> domains are resolving.
                                    </p>
                                    <div class="dns-actions">
                                        <button id="dns-reset-connected-btn" class="btn-secondary btn-sm">Reset
                                            DNS</button>
                                        <button id="dns-disable-btn2" class="btn-secondary btn-sm">Disable
                                            PKDNS</button>
                                    </div>
                                    <div id="dns-connected-feedback" class="dns-system-feedback" style="display:none;">
                                    </div>
                                </div>
                            </div>
                            <div id="dns-guide" class="inline-guide" style="display:none;">
                                <div class="inline-guide-title">üåê Browser Setup</div>
                                <p>Point your browser's DNS to this resolver to access <code>.pkarr</code> domains:</p>
                                <ol>
                                    <li><strong>macOS</strong>: System Settings ‚Üí Network ‚Üí DNS ‚Üí set to <code
                                            id="dns-guide-ip">127.0.0.1</code></li>
                                    <li><strong>Firefox</strong>: Settings ‚Üí Network ‚Üí "DNS over HTTPS" ‚Üí Off, then use
                                        system DNS</li>
                                    <li><strong>Chrome</strong>: Settings ‚Üí Security ‚Üí "Use secure DNS" ‚Üí Off, then use
                                        system DNS</li>
                                    <li>Or set DNS server to <code>127.0.0.1</code> on your router for all devices</li>
                                </ol>
                                <div class="dns-actions">
                                    <button id="dns-set-system-btn" class="btn-primary btn-sm">‚ö° Set System DNS</button>
                                    <button id="dns-reset-system-btn" class="btn-secondary btn-sm">Reset DNS</button>
                                    <button id="dns-disable-btn" class="btn-secondary btn-sm">Disable PKDNS</button>
                                </div>
                                <div id="dns-system-feedback" class="dns-system-feedback" style="display:none;"></div>
                            </div>
                            <div id="dns-disabled-note" class="inline-guide" style="display:none;">
                                <div class="inline-guide-title">‚ÑπÔ∏è DNS resolver disabled</div>
                                <p>Enable PKDNS to resolve <code>.pkarr</code> domains locally.</p>
                                <button id="dns-enable-btn" class="btn-primary btn-sm">Enable PKDNS</button>
                            </div>
                            <div id="dns-restart-notice" class="inline-guide inline-guide-success"
                                style="display:none;">
                                <div class="inline-guide-title">‚úÖ Config updated</div>
                                <p>Restart Pubky Node to apply the change.</p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- ===== KEYS TAB ===== -->
            <div class="tab-content" id="tab-keys">
                <div class="grid">
                    <!-- Key Vault -->
                    <section class="card" id="vault-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                    </svg>
                                </div>
                                <h2>Key Vault</h2>
                            </div>
                            <span class="badge" id="vault-badge">--</span>
                        </div>
                        <div class="card-body">
                            <!-- State: No vault exists -->
                            <div id="vault-create" style="display: none;">
                                <p class="settings-desc">Create an encrypted vault to securely store your secret keys.
                                </p>
                                <div class="settings-form">
                                    <div class="settings-field">
                                        <label for="vault-create-pw">Vault Password</label>
                                        <input type="password" id="vault-create-pw"
                                            placeholder="Choose a vault password (4+ chars)"
                                            autocomplete="new-password">
                                    </div>
                                    <div class="settings-field">
                                        <label for="vault-create-confirm">Confirm Password</label>
                                        <input type="password" id="vault-create-confirm"
                                            placeholder="Confirm vault password" autocomplete="new-password">
                                    </div>
                                    <button class="btn-primary" id="vault-create-btn">üîê Create Vault</button>
                                    <div id="vault-create-error" class="settings-feedback error"></div>
                                </div>
                            </div>

                            <!-- State: Vault locked -->
                            <div id="vault-locked" style="display: none;">
                                <p class="settings-desc">Unlock your vault to view and manage keys.</p>
                                <div class="settings-form">
                                    <div class="settings-field">
                                        <label for="vault-unlock-pw">Vault Password</label>
                                        <input type="password" id="vault-unlock-pw" placeholder="Enter vault password"
                                            autocomplete="current-password">
                                    </div>
                                    <button class="btn-primary" id="vault-unlock-btn">üîì Unlock Vault</button>
                                    <div id="vault-unlock-error" class="settings-feedback error"></div>
                                </div>
                            </div>

                            <!-- State: Vault unlocked -->
                            <div id="vault-unlocked" style="display: none;">
                                <div class="vault-toolbar">
                                    <button class="btn-sm btn-secondary" id="vault-lock-btn">üîí Lock</button>
                                    <button class="btn-sm btn-secondary" id="vault-add-manual-btn">+ Add Key</button>
                                    <button class="btn-sm btn-secondary" id="vault-export-all-btn">üì• Export</button>
                                    <button class="btn-sm btn-secondary" id="vault-import-btn">üì§ Import</button>
                                    <input type="file" id="vault-import-file" accept=".json" style="display:none;">
                                </div>
                                <div id="vault-keys-list" class="vault-keys-list"></div>
                                <div id="vault-empty" class="vault-empty" style="display: none;">
                                    <p>No keys in vault. Add keys from the Vanity Generator or PKARR Publisher, or add
                                        manually.</p>
                                </div>
                            </div>

                            <!-- Manual key add form (hidden until + Add Key clicked) -->
                            <div id="vault-add-form" style="display: none;">
                                <div class="settings-form">
                                    <div class="settings-field">
                                        <label for="vault-add-name">Key Name</label>
                                        <input type="text" id="vault-add-name" placeholder="e.g. My Vanity Key"
                                            autocomplete="off">
                                    </div>
                                    <div class="settings-field">
                                        <label for="vault-add-secret">Secret Key (hex)</label>
                                        <input type="password" id="vault-add-secret"
                                            placeholder="Hex or z-base-32 encoded secret" autocomplete="off"
                                            spellcheck="false">
                                    </div>
                                    <div class="settings-field">
                                        <label for="vault-add-pubkey">Public Key</label>
                                        <input type="text" id="vault-add-pubkey" placeholder="Public key (z-base-32)"
                                            autocomplete="off" spellcheck="false">
                                    </div>
                                    <div class="vault-add-actions">
                                        <button class="btn-primary btn-sm" id="vault-add-save-btn">üíæ Save to
                                            Vault</button>
                                        <button class="btn-sm btn-secondary" id="vault-add-cancel-btn">Cancel</button>
                                    </div>
                                    <div id="vault-add-error" class="settings-feedback error"></div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Identity Watchlist (moved from Status) -->
                    <section class="card" id="watchlist-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-amber">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </div>
                                <h2>Identity Watchlist</h2>
                            </div>
                            <span class="badge" id="watchlist-badge">--</span>
                        </div>
                        <div class="card-body">
                            <div class="kv-row">
                                <span class="kv-key">Republish Interval</span>
                                <span class="kv-val" id="republish-interval">--</span>
                            </div>
                            <div class="watchlist-add">
                                <input type="text" id="watchlist-input" placeholder="Paste a public key to watch..."
                                    spellcheck="false" autocomplete="off">
                                <button class="btn-primary btn-sm" id="watchlist-add-btn">+ Add</button>
                            </div>
                            <div id="watchlist-error" class="watchlist-error"></div>
                            <div class="watchlist-keys" id="watchlist-keys"></div>
                        </div>
                    </section>

                    <!-- PKARR Publisher -->
                    <section class="card" id="publisher-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-green">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M12 19V5M5 12l7-7 7 7" />
                                    </svg>
                                </div>
                                <h2>PKARR Publisher</h2>
                            </div>
                            <span class="badge" id="publisher-badge">Ready</span>
                        </div>
                        <div class="card-body">
                            <!-- Key source selector -->
                            <div class="publisher-field">
                                <label class="publisher-label">Signing Key</label>
                                <div class="publisher-key-source-tabs">
                                    <button class="pub-source-tab active" data-source="vault">üîê From Vault</button>
                                    <button class="pub-source-tab" data-source="manual">‚úèÔ∏è Manual</button>
                                    <button class="btn-sm btn-primary pub-generate-btn" id="publisher-generate-key"
                                        title="Generate a new random keypair and save to vault">üé≤ New</button>
                                </div>
                                <!-- Vault key dropdown -->
                                <div id="pub-source-vault" class="pub-source-panel">
                                    <select id="publisher-vault-select" class="pub-vault-select">
                                        <option value="">‚Äî Select a vault key ‚Äî</option>
                                    </select>
                                </div>
                                <!-- Manual key input -->
                                <div id="pub-source-manual" class="pub-source-panel" style="display:none;">
                                    <div class="publisher-key-row">
                                        <input type="password" id="publisher-secret-key"
                                            placeholder="Hex (64/128 chars) or z-base-32" spellcheck="false"
                                            autocomplete="off" class="publisher-key-input">
                                        <button class="btn-sm publisher-icon-btn" id="publisher-toggle-key"
                                            title="Show/Hide">üëÅ</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Template + Records (compact) -->
                            <div class="pub-template-records">
                                <div class="pub-template-row">
                                    <label class="publisher-label">Template</label>
                                    <div class="publisher-presets">
                                        <button class="publisher-preset-btn active" data-preset="homeserver">üè†
                                            Homeserver</button>
                                        <button class="publisher-preset-btn" data-preset="custom">‚úèÔ∏è Custom</button>
                                    </div>
                                </div>
                                <div id="publisher-records" class="publisher-records"></div>
                                <button class="btn-sm" id="publisher-add-record">+ Add Record</button>
                            </div>

                            <!-- Options + Submit row -->
                            <div class="pub-bottom-row">
                                <label class="publisher-option">
                                    <input type="checkbox" id="publisher-add-watchlist" checked>
                                    <span>Auto-republish</span>
                                </label>
                                <button class="btn-primary publisher-submit" id="publisher-submit-btn">
                                    üöÄ Sign &amp; Publish to DHT
                                </button>
                            </div>

                            <!-- Status -->
                            <div id="publisher-status" class="publisher-status"></div>
                        </div>
                    </section>

                    <!-- Vanity Key Generator -->
                    <section class="card" id="vanity-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78zm-4.95.44L17.5 4" />
                                        <path d="M15 5l2 2" />
                                    </svg>
                                </div>
                                <h2>Vanity Key Generator</h2>
                            </div>
                            <span class="badge" id="vanity-badge">Ready</span>
                        </div>
                        <div class="card-body">
                            <div class="vanity-input-row">
                                <input type="text" id="vanity-input" placeholder="e.g. pubky" spellcheck="false"
                                    autocomplete="off" maxlength="10" size="10" class="vanity-word-input">
                                <label class="vanity-toggle">
                                    <input type="checkbox" id="vanity-suffix">
                                    <span class="vanity-toggle-label">Suffix</span>
                                </label>
                                <button class="btn-primary btn-sm" id="vanity-start-btn">‚ö° Generate</button>
                                <button class="btn-secondary btn-sm" id="vanity-stop-btn" style="display:none;">‚ñ†
                                    Stop</button>
                            </div>
                            <div id="vanity-estimate" class="vanity-estimate" style="display:none;"></div>
                            <div id="vanity-progress" class="vanity-progress" style="display:none;">
                                <div class="vanity-progress-bar">
                                    <div class="vanity-progress-fill" id="vanity-progress-fill"></div>
                                </div>
                                <div class="vanity-stats">
                                    <span id="vanity-keys-checked">0 keys</span>
                                    <span id="vanity-rate">0/s</span>
                                    <span id="vanity-elapsed">0s</span>
                                </div>
                            </div>
                            <div id="vanity-result" class="vanity-result" style="display:none;">
                                <div class="kv-row">
                                    <span class="kv-key">Public Key</span>
                                    <span class="kv-val mono vanity-key" id="vanity-pubkey">--</span>
                                    <button class="copy-btn" id="vanity-copy-pubkey" title="Copy public key">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" />
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                        </svg>
                                    </button>
                                </div>
                                <div class="kv-row">
                                    <span class="kv-key">Secret Seed</span>
                                    <span class="kv-val mono vanity-key" id="vanity-seed">--</span>
                                    <button class="copy-btn" id="vanity-copy-seed" title="Copy seed">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" />
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                        </svg>
                                    </button>
                                </div>
                                <div class="vanity-warning">
                                    ‚ö†Ô∏è <strong>Back up your seed!</strong> It cannot be recovered.
                                </div>
                                <button class="btn-primary btn-sm" id="vanity-save-vault-btn"
                                    style="margin-top: 8px;">üíæ Save to Vault</button>
                            </div>
                            <div class="vanity-info collapsible" id="vanity-info">
                                <div class="collapsible-toggle vanity-info-toggle" id="vanity-info-toggle">
                                    <span class="vanity-estimates-label">üìä Time estimates</span>
                                    <svg class="collapse-chevron vanity-chevron" width="14" height="14"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                        <path d="M6 9l6 6 6-6" />
                                    </svg>
                                </div>
                                <div class="collapsible-body">
                                    <table class="vanity-time-table">
                                        <thead>
                                            <tr>
                                                <th>Length</th>
                                                <th>Combinations</th>
                                                <th>Time</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>3</td>
                                                <td>32K</td>
                                                <td>Instant</td>
                                            </tr>
                                            <tr>
                                                <td>4</td>
                                                <td>1M</td>
                                                <td>Seconds</td>
                                            </tr>
                                            <tr>
                                                <td>5</td>
                                                <td>33M</td>
                                                <td>Minutes</td>
                                            </tr>
                                            <tr>
                                                <td>6</td>
                                                <td>1B</td>
                                                <td>Hours</td>
                                            </tr>
                                            <tr>
                                                <td>7+</td>
                                                <td>34B+</td>
                                                <td>Days+</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- ===== EXPLORER TAB ===== -->
            <div class="tab-content" id="tab-explorer">
                <div class="explorer-hero">
                    <h1>Key Explorer</h1>
                    <p>Look up any PKARR public key to inspect its DNS records from the Mainline DHT.</p>
                </div>

                <div class="explorer-search-wrap">
                    <div class="explorer-search">
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                        <input type="text" id="explorer-input"
                            placeholder="Paste a 52-character z-base-32 public key..." spellcheck="false"
                            autocomplete="off">
                        <button id="explorer-btn" class="btn-primary">
                            <span>Resolve</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="explorer-error" class="alert alert-error" style="display:none;"></div>

                <!-- Results -->
                <div id="explorer-results" class="explorer-results" style="display:none;">
                    <div class="explorer-meta" id="explorer-meta"></div>
                    <div class="dns-table-wrap">
                        <div class="dns-table-header">
                            <span>NAME</span>
                            <span>TYPE</span>
                            <span>VALUE</span>
                            <span>TTL</span>
                        </div>
                        <div id="dns-records-body" class="dns-table-body"></div>
                    </div>
                </div>

                <!-- No records -->
                <div id="explorer-empty" class="explorer-empty" style="display:none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        opacity="0.3">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="15" y1="9" x2="9" y2="15" />
                        <line x1="9" y1="9" x2="15" y2="15" />
                    </svg>
                    <p>No records found for this key on the DHT.</p>
                </div>

                <!-- Loading -->
                <div id="explorer-loading" class="explorer-loading" style="display:none;">
                    <div class="spinner"></div>
                    <span>Resolving from DHT network...</span>
                </div>

                <!-- History -->
                <div class="explorer-history" id="explorer-history" style="display:none;">
                    <h3>Recent Lookups</h3>
                    <div id="history-list"></div>
                </div>
            </div>

            <!-- ===== GUIDE TAB ===== -->
            <div class="tab-content" id="tab-guide">
                <div class="guide">
                    <div class="guide-hero">
                        <h1>User Guide</h1>
                        <p>Everything you need to know about running and using Pubky Node.</p>
                    </div>

                    <div class="guide-grid">
                        <section class="guide-section">
                            <div class="guide-section-icon">üåê</div>
                            <h2>Mainline DHT Node</h2>
                            <p>Pubky Node runs a full <strong>Mainline DHT</strong> node using the BEP44 protocol. This
                                connects you to a network of millions of peers, enabling decentralized DNS record
                                storage and retrieval without any central server.</p>
                            <ul>
                                <li>Automatic peer discovery and routing table population</li>
                                <li>Server mode when not firewalled for full network participation</li>
                                <li>Configurable UDP port via <code>--dht-port</code> or <code>[dht] port</code> in
                                    config</li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üì°</div>
                            <h2>PKARR Relay</h2>
                            <p>The relay provides an <strong>HTTP API</strong> for publishing and resolving signed DNS
                                packets. Any PKARR-compatible client can use your relay to interact with the DHT.</p>
                            <ul>
                                <li><code>PUT /pkarr/:key</code> ‚Äî publish a signed packet</li>
                                <li><code>GET /pkarr/:key</code> ‚Äî resolve a key from DHT</li>
                                <li>Built-in rate limiting (2 req/s default, burst 10)</li>
                                <li>Persistent LMDB cache for fast repeat lookups</li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üîê</div>
                            <h2>DNS Publisher</h2>
                            <p>Sign and publish DNS records to the DHT using Ed25519 secret keys. Records are
                                automatically re-published at a configurable interval to stay alive on the network.</p>
                            <ul>
                                <li>Supports <strong>A</strong>, <strong>AAAA</strong>, <strong>CNAME</strong>, and
                                    <strong>TXT</strong> records
                                </li>
                                <li>Secret keys can be inline or loaded from files (Docker secrets compatible)</li>
                                <li>Automatic retry with exponential backoff on publish failures</li>
                                <li>Configure via <code>[publisher]</code> section in config.toml</li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üîç</div>
                            <h2>Key Explorer</h2>
                            <p>Look up any public key to view its DNS records stored on the DHT. Paste a 52-character
                                z-base-32 encoded public key and see the full record set.</p>
                            <ul>
                                <li>Supports all record types: A, AAAA, CNAME, TXT, NS, HTTPS, SVCB</li>
                                <li>Shows packet metadata: compressed size, age, record count</li>
                                <li>Search history stored locally in your browser</li>
                                <li>Also available via API: <code>GET /api/resolve/:key</code></li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üåê</div>
                            <h2>HTTP Proxy</h2>
                            <p>Local proxy on port <strong>9091</strong> that serves <code>.pkarr</code> user profiles
                                directly in your browser. Points any <code>.pkarr</code> hostname at 127.0.0.1 and
                                fetches the user's profile from their homeserver.</p>
                            <ul>
                                <li>One-click <strong>/etc/hosts</strong> setup from the <strong>Networks</strong> tab
                                </li>
                                <li>Auto-detects if hosts are already configured</li>
                                <li>Renders profile name, bio, and avatar as a styled page</li>
                                <li>CLI: <code>pubky-node proxy-hosts &lt;KEY&gt;</code></li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üîë</div>
                            <h2>Vanity Key Generator</h2>
                            <p>Generate PKARR keypairs with a custom z-base-32 prefix or suffix. Uses all CPU cores
                                for multi-threaded brute-force grinding.</p>
                            <ul>
                                <li>Live input validation against z-base-32 alphabet</li>
                                <li>Progress bar with keys/s rate and time estimate</li>
                                <li>3 chars = instant, 4 = seconds, 5 = minutes, 6+ = hours</li>
                                <li>CLI: <code>pubky-node vanity &lt;PREFIX&gt; [--suffix]</code></li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üëÅ</div>
                            <h2>Identity Watchlist</h2>
                            <p>Monitor public keys and keep their records alive on the DHT by periodically re-publishing
                                them. No secret key needed ‚Äî this works with public keys only.</p>
                            <ul>
                                <li>Manage watched keys from the <strong>Keys</strong> tab</li>
                                <li>Configure defaults in <code>[watchlist] keys</code></li>
                                <li>Adjustable republish interval (default: 1 hour)</li>
                                <li>Great for keeping friend / service identities available</li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <div class="guide-section-icon">üñ•</div>
                            <h2>Local DNS Resolver</h2>
                            <p>Resolve sovereign <code>.pkarr</code> domains on your local machine. Runs
                                <strong>pkdns</strong> as a subprocess that intercepts DNS queries and resolves them via
                                the DHT.
                            </p>
                            <ul>
                                <li>Disable with <code>--no-dns</code> if pkdns is not installed</li>
                                <li>Configurable ICANN fallback DNS server</li>
                                <li>Custom listen socket (default: 127.0.0.1:53)</li>
                                <li>Requires <code>pkdns</code> binary in PATH or configured via
                                    <code>[dns] binary</code>
                                </li>
                            </ul>
                        </section>
                    </div>

                    <section class="guide-section guide-section-wide">
                        <div class="guide-section-icon">üåç</div>
                        <h2>DNS Browser Setup</h2>
                        <p>Point your browser at the local pkdns resolver to browse <code>.pkarr</code> and
                            <code>.key</code> domains. pkdns forwards normal DNS queries to <code>8.8.8.8</code>,
                            so regular browsing is unaffected.
                        </p>

                        <h3>macOS (recommended ‚Äî per-TLD, no system DNS change)</h3>
                        <pre><code># Route only .pkarr and .key queries to local pkdns
sudo mkdir -p /etc/resolver
echo "nameserver 127.0.0.1" | sudo tee /etc/resolver/pkarr
echo "nameserver 127.0.0.1" | sudo tee /etc/resolver/key</code></pre>
                        <p><em>Only sovereign TLDs are routed locally. All other DNS is untouched.</em></p>

                        <h3>Linux (systemd-resolved)</h3>
                        <pre><code># Create /etc/systemd/resolved.conf.d/pubky.conf
[Resolve]
DNS=127.0.0.1
Domains=~pkarr ~key

# Then restart:
sudo systemctl restart systemd-resolved</code></pre>

                        <h3>Windows</h3>
                        <pre><code>1. Settings ‚Üí Network &amp; Internet ‚Üí Wi-Fi/Ethernet
2. Click your connection ‚Üí DNS server assignment ‚Üí Edit
3. Set Preferred DNS to: 127.0.0.1
4. Set Alternate DNS to: 8.8.8.8 (fallback)
5. Save</code></pre>

                        <h3>All Browsers: Disable Secure DNS</h3>
                        <p>Browsers with "Secure DNS" (DoH) bypass your local resolver. Disable it:</p>
                        <ul>
                            <li><strong>Chrome/Edge</strong>: Settings ‚Üí Privacy & Security ‚Üí Use Secure DNS ‚Üí Off</li>
                            <li><strong>Firefox</strong>: Settings ‚Üí Privacy ‚Üí DNS over HTTPS ‚Üí Off</li>
                        </ul>

                        <h3>Test It</h3>
                        <pre><code># Verify pkdns is resolving:
dig @127.0.0.1 yg4gxe7z1r7mr6orids9fh95y7gxhdsxjqi6nngsxxtakqaxr5no.pkarr</code></pre>
                    </section>

                    <section class="guide-section guide-section-wide">
                        <div class="guide-section-icon">‚öôÔ∏è</div>
                        <h2>Configuration Reference</h2>
                        <p>Full list of config.toml options:</p>
                        <div class="config-table-wrap">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>Section</th>
                                        <th>Key</th>
                                        <th>Default</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>[relay]</code></td>
                                        <td>http_port</td>
                                        <td>6881</td>
                                        <td>HTTP port for the PKARR relay</td>
                                    </tr>
                                    <tr>
                                        <td><code>[dht]</code></td>
                                        <td>port</td>
                                        <td>6881</td>
                                        <td>UDP port for Mainline DHT</td>
                                    </tr>
                                    <tr>
                                        <td><code>[cache]</code></td>
                                        <td>size</td>
                                        <td>1,000,000</td>
                                        <td>Max cached signed packets</td>
                                    </tr>
                                    <tr>
                                        <td><code>[cache]</code></td>
                                        <td>path</td>
                                        <td>auto</td>
                                        <td>LMDB cache directory</td>
                                    </tr>
                                    <tr>
                                        <td><code>[dns]</code></td>
                                        <td>enabled</td>
                                        <td>true</td>
                                        <td>Enable pkdns resolver</td>
                                    </tr>
                                    <tr>
                                        <td><code>[dns]</code></td>
                                        <td>socket</td>
                                        <td>127.0.0.1:53</td>
                                        <td>DNS listen address</td>
                                    </tr>
                                    <tr>
                                        <td><code>[dns]</code></td>
                                        <td>forward</td>
                                        <td>8.8.8.8:53</td>
                                        <td>ICANN fallback DNS</td>
                                    </tr>
                                    <tr>
                                        <td><code>[watchlist]</code></td>
                                        <td>enabled</td>
                                        <td>false</td>
                                        <td>Enable watchlist republisher</td>
                                    </tr>
                                    <tr>
                                        <td><code>[watchlist]</code></td>
                                        <td>keys</td>
                                        <td>[]</td>
                                        <td>Public keys to watch (z-base-32)</td>
                                    </tr>
                                    <tr>
                                        <td><code>[watchlist]</code></td>
                                        <td>republish_interval_secs</td>
                                        <td>3600</td>
                                        <td>Seconds between republish cycles</td>
                                    </tr>
                                    <tr>
                                        <td><code>[publisher]</code></td>
                                        <td>enabled</td>
                                        <td>false</td>
                                        <td>Enable DNS record publisher</td>
                                    </tr>
                                    <tr>
                                        <td><code>[publisher]</code></td>
                                        <td>interval_secs</td>
                                        <td>3600</td>
                                        <td>Seconds between publish cycles</td>
                                    </tr>
                                    <tr>
                                        <td><code>[publisher]</code></td>
                                        <td>max_retries</td>
                                        <td>3</td>
                                        <td>Max retry attempts per publish</td>
                                    </tr>
                                    <tr>
                                        <td><code>[publisher]</code></td>
                                        <td>retry_delay_secs</td>
                                        <td>5</td>
                                        <td>Base delay for exponential backoff</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section class="guide-section guide-section-wide">
                        <div class="guide-section-icon">üöÄ</div>
                        <h2>CLI Quick Reference</h2>
                        <pre class="code-block"><code>## Running the Node
pubky-node                                    # Run with defaults
pubky-node run --no-dns                       # Skip DNS resolver
pubky-node run --verbose                      # Debug logging
pubky-node run --relay-port 8080              # Custom relay port
pubky-node run --dashboard-port 3000          # Custom dashboard port
pubky-node run --data-dir ./my-data           # Custom data directory

## DHT / Key Operations (no running node needed)
pubky-node resolve &lt;KEY&gt;                      # Resolve a key's DNS records
pubky-node resolve &lt;KEY&gt; --json               # Output as JSON
pubky-node publish --secret-key &lt;HEX&gt; \
  --record "HTTPS _pubky . target=host.com"   # Publish DNS records
pubky-node keygen                             # Generate new Ed25519 keypair
pubky-node keygen --json                      # Output keypair as JSON

## Vanity Keys
pubky-node vanity abc                         # Find key starting with "abc"
pubky-node vanity xyz --suffix                # Find key ending with "xyz"
pubky-node vanity pk -t 8                     # Use 8 threads

## HTTP Proxy
pubky-node proxy-hosts &lt;KEY1&gt; &lt;KEY2&gt;          # Add keys to /etc/hosts
pubky-node proxy-hosts --reset                # Remove proxy entries

## System / DNS
pubky-node status                             # Query running node status
pubky-node status --json                      # Raw JSON output
pubky-node dns-setup                          # Configure OS DNS resolver
pubky-node dns-setup --remove                 # Remove DNS configuration
pubky-node dns-setup --dry-run                # Preview changes

## Identity Watchlist (requires running node)
pubky-node watchlist list                     # Show all watched keys
pubky-node watchlist add &lt;KEY&gt;                # Add key to watchlist
pubky-node watchlist remove &lt;KEY&gt;             # Remove key from watchlist

## Homeserver (requires running node)
pubky-node homeserver status                  # State, PID, ports
pubky-node homeserver start                   # Start homeserver process
pubky-node homeserver stop                    # Stop homeserver process
pubky-node homeserver check                   # Prerequisites check
pubky-node homeserver token                   # Generate signup invite token
pubky-node homeserver users                   # List registered users
pubky-node homeserver publish-pkarr           # Publish PKARR record for homeserver key
pubky-node homeserver logs -n 100             # Tail homeserver logs

## Tunnel (requires running node)
pubky-node tunnel status                      # Tunnel state + URL
pubky-node tunnel start                       # Start Cloudflare quick-tunnel
pubky-node tunnel stop                        # Stop quick-tunnel
pubky-node tunnel check                       # Check cloudflared binary

## Node Control (requires running node)
pubky-node node restart                       # Restart the node
pubky-node node shutdown                      # Graceful shutdown</code></pre>
                    </section>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Settings Tab ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="tab-content" id="tab-settings">
                <div class="grid-1">
                    <!-- Password Management -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üîê Dashboard Password</div>
                        </div>
                        <div class="card-body">
                            <p class="settings-desc">Change your dashboard login password.</p>
                            <div class="settings-form" id="settings-password-form">
                                <div class="settings-field">
                                    <label for="settings-current-pw">Current Password</label>
                                    <input type="password" id="settings-current-pw" placeholder="Enter current password"
                                        autocomplete="current-password">
                                </div>
                                <div class="settings-field">
                                    <label for="settings-new-pw">New Password</label>
                                    <input type="password" id="settings-new-pw"
                                        placeholder="Enter new password (4+ chars)" autocomplete="new-password">
                                </div>
                                <div class="settings-field">
                                    <label for="settings-confirm-pw">Confirm New Password</label>
                                    <input type="password" id="settings-confirm-pw" placeholder="Confirm new password"
                                        autocomplete="new-password">
                                </div>
                                <button class="btn-primary" id="settings-change-pw-btn">üîÑ Change Password</button>
                                <div id="settings-pw-feedback" class="settings-feedback"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Node Info -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üìÇ Data & Storage</div>
                        </div>
                        <div class="card-body">
                            <div class="info-row">
                                <span class="info-label">Data Directory</span>
                                <span class="info-value mono" id="settings-data-dir">‚Äî</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Config File</span>
                                <span class="info-value mono" id="settings-config-file">‚Äî</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Auth File</span>
                                <span class="info-value mono" id="settings-auth-file">‚Äî</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Dashboard Port</span>
                                <span class="info-value" id="settings-port">9090</span>
                            </div>
                        </div>
                    </div>

                    <!-- About -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">‚ÑπÔ∏è About Pubky Node</div>
                        </div>
                        <div class="card-body">
                            <div class="info-row">
                                <span class="info-label">Version</span>
                                <span class="info-value" id="settings-version">‚Äî</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Platform</span>
                                <span class="info-value" id="settings-platform">‚Äî</span>
                            </div>
                            <p class="settings-about-text">
                                Pubky Node is sovereign infrastructure for the open web.
                                Run your own DHT relay, DNS resolver, HTTP proxy, and homeserver.
                            </p>
                            <div class="settings-links">
                                <a href="https://pubky.tech" target="_blank" rel="noopener">pubky.tech</a>
                                <a href="https://github.com/pubky" target="_blank" rel="noopener">GitHub</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== Homeserver Tab ========== -->
            <div class="tab-content" id="tab-homeserver">
                <div class="grid">

                    <!-- Prerequisites Check -->
                    <section class="card" id="hs-prereq-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-blue">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                                    </svg>
                                </div>
                                <h2>Prerequisites</h2>
                            </div>
                            <div style="display:flex;gap:6px;">
                                <button class="btn-sm btn-secondary" id="hs-check-btn">Check</button>
                                <button class="btn-sm btn-primary" id="hs-fix-btn">üîß Fix All</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="hs-prereq-list" class="hs-prereq-list">
                                <div class="hs-prereq-item"><span class="hs-prereq-label">PostgreSQL</span><span
                                        class="hs-prereq-status" id="hs-pg-status">‚Äî</span></div>
                                <div class="hs-prereq-item"><span class="hs-prereq-label">Database</span><span
                                        class="hs-prereq-status" id="hs-db-status">‚Äî</span></div>
                                <div class="hs-prereq-item"><span class="hs-prereq-label">Binary</span><span
                                        class="hs-prereq-status" id="hs-bin-status">‚Äî</span></div>
                                <div class="hs-prereq-item"><span class="hs-prereq-label">Config</span><span
                                        class="hs-prereq-status" id="hs-cfg-status">‚Äî</span></div>
                            </div>
                            <div class="hs-form-actions" style="margin-top:12px;">
                                <button class="btn-sm btn-secondary" id="hs-gen-config-btn">Generate Config</button>
                            </div>
                            <div id="hs-fix-log"
                                style="display:none;margin-top:10px;font-size:12px;line-height:1.8;color:var(--text-secondary);font-family:var(--font-mono);">
                            </div>
                        </div>
                    </section>


                    <!-- Homeserver Control + Stats -->
                    <section class="card" id="hs-control-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-green">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <rect x="2" y="2" width="20" height="8" rx="2" />
                                        <rect x="2" y="14" width="20" height="8" rx="2" />
                                        <circle cx="6" cy="6" r="1" />
                                        <circle cx="6" cy="18" r="1" />
                                    </svg>
                                </div>
                                <h2>Homeserver</h2>
                            </div>
                            <span class="badge" id="hs-state-badge">Stopped</span>
                            <span id="hs-stats-badge" style="display:none;"></span>
                        </div>
                        <div class="card-body">
                            <div id="hs-server-info" style="display:none;" class="hs-info-grid">
                                <div class="info-row"><span class="info-label">PID</span><span class="info-value"
                                        id="hs-pid">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Uptime</span><span class="info-value"
                                        id="hs-uptime">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">HTTP</span><span class="info-value"
                                        id="hs-port-icann">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Pubky</span><span class="info-value"
                                        id="hs-port-pubky">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Admin</span><span class="info-value"
                                        id="hs-port-admin">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Version</span><span class="info-value"
                                        id="hs-version">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Users</span><span class="info-value"
                                        id="hs-users">‚Äî</span></div>
                                <div class="info-row"><span class="info-label">Signup Mode</span><span
                                        class="info-value" id="hs-signup-mode">‚Äî</span></div>
                                <div class="info-row hs-info-full"><span class="info-label">Server Key</span><span
                                        class="info-value mono" id="hs-server-key" style="font-size:10px;">‚Äî</span>
                                </div>
                            </div>
                            <div class="hs-control-btns">
                                <button class="btn-primary btn-sm" id="hs-start-btn">‚ñ∂ Start Server</button>
                                <button class="btn-secondary btn-sm" id="hs-stop-btn" style="display:none;">‚ñ† Stop
                                    Server</button>
                            </div>
                            <div id="hs-control-msg" class="publisher-status" style="display:none;margin-top:10px;">
                            </div>
                        </div>
                    </section>


                    <!-- Invite Tokens -->
                    <section class="card" id="hs-invite-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M2 12h5" />
                                        <path d="M17 12h5" />
                                        <rect x="7" y="4" width="10" height="16" rx="2" />
                                        <path d="M12 8v8" />
                                    </svg>
                                </div>
                                <h2>Invite Tokens</h2>
                            </div>
                            <span class="badge" id="hs-invite-badge">Ready</span>
                        </div>
                        <div class="card-body">
                            <button class="btn-primary btn-sm" id="hs-gen-token-btn">Generate Token</button>
                            <div id="hs-token-display" style="display:none;margin-top:14px;">
                                <div class="export-hex-row">
                                    <code class="export-hex" id="hs-token-value">‚Äî</code>
                                    <button class="btn-sm" id="hs-token-copy">üìã</button>
                                </div>
                                <div id="hs-token-qr" class="export-qr" style="margin-top:12px;"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Configuration -->
                    <section class="card" id="hs-config-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="3" />
                                        <path
                                            d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z" />
                                    </svg>
                                </div>
                                <h2>Configuration</h2>
                            </div>
                            <span class="badge" id="hs-config-badge">‚Äî</span>
                        </div>
                        <div class="card-body">
                            <div class="hs-config-form">
                                <div class="publisher-field">
                                    <label class="publisher-label">Database URL</label>
                                    <input type="text" id="hs-cfg-db-url" class="publisher-key-input"
                                        placeholder="postgres://localhost:5432/pubky_homeserver">
                                </div>
                                <div class="hs-config-row">
                                    <div class="publisher-field">
                                        <label class="publisher-label">Signup Mode</label>
                                        <select id="hs-cfg-signup-mode" class="publisher-key-input">
                                            <option value="token_required">Token Required</option>
                                            <option value="open">Open</option>
                                            <option value="closed">Closed</option>
                                        </select>
                                    </div>
                                    <div class="publisher-field">
                                        <label class="publisher-label">Admin Password</label>
                                        <input type="password" id="hs-cfg-admin-pw" class="publisher-key-input">
                                    </div>
                                </div>
                                <div class="hs-config-row">
                                    <div class="publisher-field">
                                        <label class="publisher-label">Public IP</label>
                                        <input type="text" id="hs-cfg-public-ip" class="publisher-key-input"
                                            placeholder="auto-detected">
                                    </div>
                                    <div class="publisher-field">
                                        <label class="publisher-label">ICANN Domain</label>
                                        <input type="text" id="hs-cfg-domain" class="publisher-key-input"
                                            placeholder="localhost">
                                    </div>
                                </div>
                                <div class="publisher-field">
                                    <label class="publisher-label">Storage Quota (MB, 0 = unlimited)</label>
                                    <input type="number" id="hs-cfg-quota" class="publisher-key-input" value="0"
                                        min="0">
                                </div>
                                <div class="hs-form-actions">
                                    <button class="btn-primary btn-sm" id="hs-save-config-btn">Save Config</button>
                                    <span id="hs-config-msg" class="hs-action-msg"></span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- PKARR Publishing -->
                    <section class="card" id="hs-pkarr-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="10" />
                                        <polyline points="12 8 12 12 14 14" />
                                    </svg>
                                </div>
                                <h2>PKARR Publishing</h2>
                            </div>
                            <span class="badge" id="hs-pkarr-badge">‚Äî</span>
                        </div>
                        <div class="card-body">
                            <p class="hs-desc">Publishes a PKARR DNS record pointing your homeserver's public key to its
                                ICANN domain. Requires the homeserver secret key to be in the vault.</p>
                            <div class="hs-form-actions" style="margin-top:0;">
                                <button class="btn-primary btn-sm" id="hs-publish-pkarr-btn">üåê Publish Now</button>
                                <span id="hs-publish-pkarr-msg" class="hs-action-msg"></span>
                            </div>
                            <p class="hs-desc" style="margin-top:10px;margin-bottom:0;">Auto-republishes every 4 hours
                                after manual trigger.</p>
                        </div>
                    </section>

                    <!-- Log Stream -->
                    <section class="card" id="hs-logs-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-blue">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                        <polyline points="14 2 14 8 20 8" />
                                        <line x1="16" y1="13" x2="8" y2="13" />
                                        <line x1="16" y1="17" x2="8" y2="17" />
                                    </svg>
                                </div>
                                <h2>Log Stream</h2>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center;">
                                <input type="text" id="hs-log-filter" class="hs-filter-input" placeholder="Filter‚Ä¶">
                                <button class="btn-sm btn-secondary" id="hs-log-clear-btn">Clear</button>
                                <span class="badge" id="hs-log-badge">Idle</span>
                            </div>
                        </div>
                        <div class="card-body" style="padding:0;">
                            <div id="hs-log-output" class="hs-log-output">
                                <span style="color:var(--text-tertiary);">Start the homeserver to see logs‚Ä¶</span>
                            </div>
                        </div>
                    </section>

                    <!-- Users & Quotas -->
                    <section class="card" id="hs-users-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-green">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                        <circle cx="9" cy="7" r="4" />
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                    </svg>
                                </div>
                                <h2>Users</h2>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center;">
                                <input type="text" id="hs-user-search" class="hs-filter-input"
                                    placeholder="Filter pubkey‚Ä¶">
                                <button class="btn-sm btn-secondary" id="hs-users-refresh-btn">Refresh</button>
                                <span class="badge" id="hs-users-badge">‚Äî</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="hs-users-table" style="font-size:12px;">
                                <span style="color:var(--text-tertiary);">Homeserver must be running to list
                                    users.</span>
                            </div>
                        </div>
                    </section>

                    <!-- Cloudflare Tunnel -->
                    <section class="card" id="hs-tunnel-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-orange">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M5 12.55a11 11 0 0 1 14.08 0" />
                                        <path d="M1.42 9a16 16 0 0 1 21.16 0" />
                                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0" />
                                        <line x1="12" y1="20" x2="12.01" y2="20" />
                                    </svg>
                                </div>
                                <h2>Cloudflare Tunnel</h2>
                            </div>
                            <span class="badge" id="hs-tunnel-badge">Stopped</span>
                        </div>
                        <div class="card-body">
                            <p class="hs-desc">Expose your homeserver publicly via a free Cloudflare quick-tunnel.
                                Automatically updates ICANN domain and republishes PKARR after connecting.</p>
                            <div id="hs-tunnel-url" class="hs-url-display"></div>
                            <div id="hs-tunnel-no-binary" class="hs-warn">
                                ‚ö† <code>cloudflared</code> not found. <a
                                    href="https://github.com/cloudflare/cloudflared/releases/latest" target="_blank"
                                    rel="noopener" style="color:var(--accent);">Download here</a> and place in PATH.
                            </div>
                            <div class="hs-form-actions" style="margin-top:0;">
                                <button class="btn-primary btn-sm" id="hs-tunnel-start-btn">‚ñ∂ Start Tunnel</button>
                                <button class="btn-secondary btn-sm" id="hs-tunnel-stop-btn">‚ñ† Stop</button>
                            </div>
                        </div>
                    </section>

                    <!-- Identity Signup -->
                    <section class="card" id="hs-identity-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-purple">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                        <circle cx="12" cy="7" r="4" />
                                    </svg>
                                </div>
                                <h2>Identity Signup</h2>
                            </div>
                            <span class="badge" id="hs-identity-badge">‚Äî</span>
                        </div>
                        <div class="card-body">
                            <p class="hs-desc">Register a vault key as a user on this homeserver.</p>
                            <div class="publisher-field">
                                <label class="publisher-label">Key (from vault)</label>
                                <select id="hs-identity-key-select" class="publisher-key-input">
                                    <option value="">‚Äî select a key ‚Äî</option>
                                </select>
                            </div>
                            <div class="publisher-field">
                                <label class="publisher-label">Signup Token (optional)</label>
                                <input type="text" id="hs-identity-token" class="publisher-key-input"
                                    placeholder="Leave blank if homeserver is open">
                            </div>
                            <div class="hs-form-actions">
                                <button class="btn-primary btn-sm" id="hs-identity-signup-btn">‚úÖ Sign Up</button>
                                <span id="hs-identity-msg" class="hs-action-msg"></span>
                            </div>
                            <div id="hs-identity-list" style="margin-top:16px;font-size:12px;"></div>
                        </div>
                    </section>

                    <!-- File Browser -->
                    <section class="card" id="hs-files-panel">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon card-icon-blue">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                                    </svg>
                                </div>
                                <h2>File Browser</h2>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center;">
                                <select id="hs-files-user-select" class="hs-filter-input" style="width:140px;">
                                    <option value="">‚Äî select user ‚Äî</option>
                                </select>
                                <button class="btn-sm btn-secondary" id="hs-files-refresh-btn">Browse</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="hs-files-tree" class="hs-files-tree">
                                <span style="color:var(--text-tertiary);">Select a user and click Browse to explore
                                    their /pub directory.</span>
                            </div>
                            <div id="hs-files-preview" class="hs-files-preview"></div>
                        </div>
                    </section>

                </div>
            </div>

    </div>
    </div>
    </main>

    <footer class="footer">
        <span>Pubky Node ‚Ä¢ Sovereign Infrastructure</span>
        <span id="last-updated">Last updated: --</span>
    </footer>
    </div>

    <script src="/qrcode.min.js"></script>
    <script src="/dashboard.js"></script>

    <!-- Ring Export Modal -->
    <div id="ring-export-modal" class="modal-overlay">
        <div class="modal-box" style="max-width:420px;">
            <div class="modal-header">
                <h3>üîë Export Key</h3>
                <button id="ring-export-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-section">
                    <label class="export-label">Secret Key (hex)</label>
                    <div class="export-hex-row">
                        <code class="export-hex" id="export-hex-value">--</code>
                        <button class="btn-sm" id="export-copy-hex" title="Copy">üìã</button>
                    </div>
                </div>
                <div class="export-section">
                    <label class="export-label">Ring Migrate QR</label>
                    <p class="export-hint">Scan with Pubky Ring to import this key</p>
                    <div id="export-qr-container" class="export-qr"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>